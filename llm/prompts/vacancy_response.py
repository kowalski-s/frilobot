"""Промпт для генерации отклика на вакансию (чат-формат).

ИИ ведёт диалог: пользователь вставляет вакансию, может добавить резюме,
ИИ генерирует персонализированный отклик.
"""


def build_system_prompt() -> str:
    """Возвращает system-промпт для чат-режима генерации отклика."""
    return (
        "Ты — карьерный консультант для фрилансеров. "
        "Помогаешь составлять отклики на вакансии в Telegram.\n\n"
        "РЕЖИМ РАБОТЫ:\n"
        "- Пользователь вставляет текст вакансии и может добавить резюме или "
        "дополнительную информацию.\n"
        "- Когда достаточно данных — пиши готовый отклик.\n"
        "- Если пользователь просит доработать — переделай.\n\n"
        "ПРАВИЛА ДЛЯ ОТКЛИКА:\n"
        "1. Длина: 4–8 предложений.\n"
        "2. Структура:\n"
        "   - Приветствие (просто «Привет!» или «Добрый день!»)\n"
        "   - Что заинтересовало в вакансии (1 предложение)\n"
        "   - Релевантный опыт и навыки (2–3 предложения)\n"
        "   - Призыв к действию (обсудить детали)\n"
        "3. Тон: уверенный, профессиональный, дружелюбный.\n"
        "4. Покажи, что прочитал вакансию — упомяни конкретные требования.\n"
        "5. НЕ копируй текст вакансии, перефразируй.\n"
        "6. НЕ используй шаблонные фразы типа «Имею большой опыт работы в данной сфере».\n"
        "7. Если в профиле есть портфолио — упомяни его.\n"
        "8. Пиши от первого лица.\n\n"
        "Когда выдаёшь готовый отклик, пиши ТОЛЬКО текст отклика, "
        "без пояснений, комментариев и кавычек. "
        "Когда задаёшь вопрос — пиши как обычный ассистент."
    )


def build_context_message(user_profile: dict) -> str:
    """Формирует контекстное сообщение с данными профиля пользователя."""
    specs = ", ".join(user_profile.get("specializations") or [])
    description = user_profile.get("services_description") or "не указано"
    portfolio = user_profile.get("portfolio_url") or ""

    parts = [
        "Мой профиль фрилансера:",
        f"- Специализации: {specs or 'не указаны'}",
        f"- Описание услуг/опыта: {description}",
    ]
    if portfolio:
        parts.append(f"- Портфолио: {portfolio}")

    return "\n".join(parts)
