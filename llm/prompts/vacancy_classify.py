"""Промпт для классификации сообщения как вакансии.

Определяет, является ли сообщение из канала вакансией,
и извлекает структурированные данные.
"""


def build_prompt(
    message_text: str,
    user_keywords: list[str],
) -> tuple[str, str]:
    """Строит system + user промпт для классификации вакансии.

    Args:
        message_text: текст сообщения из канала
        user_keywords: ключевые слова из профиля поиска пользователя

    Returns:
        (system_prompt, user_prompt)
    """
    system_prompt = (
        "Ты — классификатор вакансий для фрилансеров. "
        "Твоя задача — определить, является ли сообщение из Telegram-канала вакансией "
        "или предложением о работе для фрилансера.\n\n"
        "ПРАВИЛА КЛАССИФИКАЦИИ:\n"
        "1. Вакансия — это сообщение, где ИЩУТ исполнителя (фрилансера, подрядчика, специалиста).\n"
        "2. НЕ вакансия: реклама, новости, обсуждения, предложения услуг (кто-то ПРЕДЛАГАЕТ свои услуги).\n"
        "3. НЕ вакансия: сообщения про вакансии в штат (нужна полная занятость, офис).\n"
        "4. Учитывай ключевые слова пользователя — если вакансия совпадает по тематике, "
        "она более релевантна.\n\n"
        "ФОРМАТ ОТВЕТА — строго JSON без markdown-обёртки:\n"
        '{"is_vacancy": true/false, "title": "краткое название задачи", '
        '"budget": "бюджет если указан или null", "skills": ["навык1", "навык2"], '
        '"relevance_score": 0.0-1.0}\n\n'
        "Поле relevance_score: 0.0 — совсем не подходит, 1.0 — идеально подходит "
        "под ключевые слова пользователя.\n"
        "Если is_vacancy = false, остальные поля заполни null/пустыми.\n"
        "Отвечай ТОЛЬКО JSON, без пояснений."
    )

    keywords_str = ", ".join(user_keywords) if user_keywords else "не заданы"

    user_prompt = (
        f"Ключевые слова пользователя: {keywords_str}\n\n"
        f"СООБЩЕНИЕ ИЗ КАНАЛА:\n{message_text.strip()}"
    )

    return system_prompt, user_prompt
